<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayTV - Shiko TV Online Falas</title>
    
    <!-- CSS -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white; 
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid #00d4ff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #00d4ff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 32px;
        }
        
        .search-box {
            position: relative;
            width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border-radius: 25px;
            border: 2px solid #00d4ff;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }
        
        .search-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #00d4ff;
            font-size: 18px;
            cursor: pointer;
        }
        
        /* Menu */
        .categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .categories::-webkit-scrollbar {
            height: 4px;
        }
        
        .categories::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        
        .categories::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 2px;
        }
        
        .category-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .category-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .category-btn.active {
            background: #00d4ff;
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        /* Channels Grid */
        .channels-section {
            padding: 30px 0 50px;
        }
        
        .channels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .channel-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .channel-card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 10px 25px rgba(0, 212, 255, 0.2);
        }
        
        .channel-header {
            padding: 20px 20px 15px;
            text-align: center;
        }
        
        .channel-icon {
            font-size: 48px;
            margin-bottom: 10px;
            display: block;
        }
        
        .channel-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .channel-category {
            display: inline-block;
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .channel-content {
            padding: 0 20px 20px;
        }
        
        .channel-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 15px;
            height: 40px;
            overflow: hidden;
        }
        
        .play-btn {
            width: 100%;
            background: linear-gradient(45deg, #00d4ff, #0099ff);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .play-btn:hover {
            background: linear-gradient(45deg, #0099ff, #00d4ff);
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }
        
        .play-btn i {
            font-size: 18px;
        }
        
        /* Video Modal */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            width: 90%;
            max-width: 900px;
            background: rgba(20, 20, 40, 0.95);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #00d4ff;
            position: relative;
        }
        
        .modal-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ff4444;
        }
        
        .video-container {
            padding: 20px;
            text-align: center;
        }
        
        #video-player {
            width: 100%;
            max-height: 70vh;
            border-radius: 10px;
            background: #000;
        }
        
        .loading {
            padding: 40px;
            text-align: center;
            color: #00d4ff;
            font-size: 18px;
        }
        
        .error-message {
            padding: 40px;
            text-align: center;
            color: #ff4444;
            font-size: 18px;
        }
        
        .error-message button {
            margin-top: 20px;
            padding: 10px 20px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.9);
            padding: 30px 0;
            text-align: center;
            margin-top: 50px;
            border-top: 2px solid #00d4ff;
        }
        
        .footer-logo {
            font-size: 24px;
            color: #00d4ff;
            margin-bottom: 10px;
        }
        
        .copyright {
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-box {
                width: 100%;
            }
            
            .channels-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .categories {
                gap: 8px;
            }
            
            .category-btn {
                padding: 8px 15px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 480px) {
            .channels-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo">
                    <span class="logo-icon">üì∫</span>
                    <span>PLAYTV</span>
                </a>
                
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="K√´rko kanale...">
                    <button class="search-btn" id="searchBtn">üîç</button>
                </div>
            </div>
            
            <nav class="categories">
                <button class="category-btn active" data-category="all">üåç T√´ Gjitha</button>
                <button class="category-btn" data-category="documentarios">üé¨ Dokumentar√´</button>
                <button class="category-btn" data-category="esportes">‚öΩ Sport</button>
                <button class="category-btn" data-category="filmesseries">üé• Filma & Seri</button>
                <button class="category-btn" data-category="infantil">üß∏ F√´mij√´</button>
                <button class="category-btn" data-category="jornalismo">üì∞ Lajme</button>
                <button class="category-btn" data-category="musicas">üéµ Muzik√´</button>
            </nav>
        </div>
    </header>

    <!-- Channels Section -->
    <main class="channels-section">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 30px; color: #00d4ff;">
                üé¨ Kanalet TV n√´ Dispozicion
            </h1>
            
            <div class="channels-grid" id="channelsContainer">
                <!-- Kanale do t√´ ngarkohen k√´tu -->
                <div class="loading">
                    ‚è≥ Po ngarkoj kanalet...
                </div>
            </div>
        </div>
    </main>

    <!-- Video Modal -->
    <div class="video-modal" id="videoModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">üé¨ Duke Luajtur</div>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            
            <div class="video-container">
                <video id="video-player" controls playsinline>
                    Shfletuesi juaj nuk mb√´shtet video elementin.
                </video>
                <div class="loading" id="videoLoading">
                    ‚è≥ Po ngarkoj transmetimin...
                </div>
                <div class="error-message" id="videoError" style="display: none;">
                    ‚ùå Nuk mund t√´ ngarkohet transmetimi.
                    <br>
                    <button onclick="retryPlayback()">üîÑ Riprovoni</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-logo">üì∫ PLAYTV</div>
            <div class="copyright">
                ¬© 2024 PlayTV - T√´ gjitha t√´ drejtat e rezervuara
                <br>
                <small style="color: rgba(255,255,255,0.3);">Shiko TV Online falas</small>
            </div>
        </div>
    </footer>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <!-- Main JavaScript -->
    <script>
        // ==================== KONFIGURIMI ====================
        const PLAYLIST_URL = 'play.m3u'; // Rruga e skedarit M3U
        let allChannels = [];
        let currentHls = null;
        let currentChannel = null;

        // ==================== FUNKSIONET KRYESORE ====================
        
        // 1. NGARKO LIST√ãN M3U
        async function loadPlaylist() {
            try {
                console.log('üîÑ Po ngarkoj list√´n e kanaleve...');
                const response = await fetch(PLAYLIST_URL);
                const m3uText = await response.text();
                
                allChannels = parseM3U(m3uText);
                console.log(`‚úÖ U gjet√´n ${allChannels.length} kanale`);
                
                displayChannels(allChannels);
                setupEventListeners();
                
            } catch (error) {
                console.error('‚ùå Gabim n√´ ngarkimin e list√´s:', error);
                $('#channelsContainer').html(`
                    <div class="error-message" style="grid-column: 1/-1;">
                        ‚ùå Nuk mund t√´ ngarkohet lista e kanaleve!
                        <br>
                        Sigurohu q√´ skedari 'play.m3u' t√´ jet√´ n√´ t√´ nj√´jtin drejtor.
                    </div>
                `);
            }
        }

        // 2. PARSEO SKEDARIN M3U
        function parseM3U(m3uText) {
            const channels = [];
            const lines = m3uText.split('\n');
            let currentChannel = {};
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (line.startsWith('#EXTINF:')) {
                    // Nxjerr t√´ dh√´nat nga linja EXTINF
                    const info = line.substring(8);
                    const commaIndex = info.lastIndexOf(',');
                    const params = info.substring(0, commaIndex);
                    const title = info.substring(commaIndex + 1).trim();
                    
                    // Nxjerr kategorin√´
                    const groupMatch = params.match(/group-title="([^"]+)"/);
                    const category = groupMatch ? groupMatch[1] : 't√´-gjitha';
                    
                    // Nxjerr logo
                    const logoMatch = params.match(/tvg-logo="([^"]+)"/);
                    const logo = logoMatch ? logoMatch[1] : '';
                    
                    currentChannel = {
                        title: title.replace(/^[üî¥üì∫üóûÔ∏èüé≠üß∏üî¨üè†‚ò™Ô∏èüåçüé¨üé•‚öΩüì∞üéµüß∏üî¨üèòÔ∏èüïåüåêüì°]+/, '').trim(),
                        originalTitle: title,
                        category: category,
                        logo: logo,
                        url: ''
                    };
                    
                } else if (line && !line.startsWith('#') && currentChannel.title) {
                    // Kjo √´sht√´ URL-ja e stream-it
                    currentChannel.url = line.trim();
                    channels.push({...currentChannel});
                    currentChannel = {};
                }
            }
            
            return channels;
        }

        // 3. SHFAQ KANALET N√ã FAQE
        function displayChannels(channels) {
            if (channels.length === 0) {
                $('#channelsContainer').html(`
                    <div class="error-message" style="grid-column: 1/-1;">
                        ‚ùå Nuk u gjet√´n kanale!
                    </div>
                `);
                return;
            }
            
            let html = '';
            
            channels.forEach((channel, index) => {
                const icon = getChannelIcon(channel.title);
                const categoryName = getCategoryName(channel.category);
                
                html += `
                    <div class="channel-card" data-category="${channel.category}" data-index="${index}">
                        <div class="channel-header">
                            <span class="channel-icon">${icon}</span>
                            <h3 class="channel-title">${channel.title}</h3>
                            <span class="channel-category">${categoryName}</span>
                        </div>
                        <div class="channel-content">
                            <p class="channel-description">
                                Shiko ${channel.title} live n√´ cil√´si t√´ lart√´.
                            </p>
                            <button class="play-btn" onclick="playChannel(${index})">
                                <i>‚ñ∂</i> Shiko Tani
                            </button>
                        </div>
                    </div>
                `;
            });
            
            $('#channelsContainer').html(html);
        }

        // 4. LUJ KANALIN
        function playChannel(index) {
            const channel = allChannels[index];
            if (!channel || !channel.url) {
                alert('‚ùå URL e transmetimit nuk √´sht√´ e disponueshme!');
                return;
            }
            
            currentChannel = channel;
            
            // Shfaq modal
            $('#modalTitle').text(`üé¨ ${channel.title}`);
            $('#videoModal').fadeIn();
            $('#videoLoading').show();
            $('#videoError').hide();
            $('#video-player').hide();
            
            // Kontrollo n√´se HLS mb√´shtetet
            const video = document.getElementById('video-player');
            
            if (Hls.isSupported()) {
                console.log('üîß Duke p√´rdorur HLS.js');
                
                // Fshi instanc√´n e m√´parshme
                if (currentHls) {
                    currentHls.destroy();
                    currentHls = null;
                }
                
                // Krijo instanc√´ t√´ re
                currentHls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 30,
                    maxBufferLength: 30
                });
                
                currentHls.loadSource(channel.url);
                currentHls.attachMedia(video);
                
                currentHls.on(Hls.Events.MANIFEST_PARSED, function() {
                    console.log('‚úÖ Manifesti u p√´rpunua');
                    $('#videoLoading').hide();
                    $('#video-player').fadeIn();
                    video.play().catch(e => {
                        console.log('‚ÑπÔ∏è Luajtja automatike u parandalua, kliko Play');
                        $('#videoLoading').html('Kliko butonin Play p√´r t√´ filluar');
                    });
                });
                
                currentHls.on(Hls.Events.ERROR, function(event, data) {
                    console.error('‚ùå Gabim HLS:', data.type, data.details);
                    
                    if (data.fatal) {
                        $('#videoLoading').hide();
                        $('#videoError').show();
                        
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                console.log('üîÅ Riprovim p√´r shkak t√´ gabimit n√´ rrjet...');
                                currentHls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                console.log('üîÅ Rip√´rpiekje e media error...');
                                currentHls.recoverMediaError();
                                break;
                            default:
                                currentHls.destroy();
                                break;
                        }
                    }
                });
                
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // P√´rdor HLS native p√´r Safari
                console.log('üîß Duke p√´rdorur HLS native (Safari)');
                video.src = channel.url;
                video.addEventListener('loadedmetadata', function() {
                    $('#videoLoading').hide();
                    $('#video-player').fadeIn();
                    video.play();
                });
            } else {
                $('#videoLoading').hide();
                $('#videoError').show();
                console.error('‚ùå Shfletuesi nuk mb√´shtet HLS');
            }
        }

        // 5. RIPROVO LUJTJEN
        function retryPlayback() {
            if (currentChannel) {
                playChannel(allChannels.indexOf(currentChannel));
            }
        }

        // 6. FUNKSIONE NDIHM√ãSE
        function getChannelIcon(title) {
            const lower = title.toLowerCase();
            if (lower.includes('top')) return '‚≠ê';
            if (lower.includes('klan')) return 'üîµ';
            if (lower.includes('vizion')) return 'üî¥';
            if (lower.includes('rtsh')) return 'üèõÔ∏è';
            if (lower.includes('rtk')) return 'üì°';
            if (lower.includes('big brother')) return 'üî¥';
            if (lower.includes('sport')) return '‚öΩ';
            if (lower.includes('film')) return 'üé¨';
            if (lower.includes('news') || lower.includes('lajme')) return 'üì∞';
            if (lower.includes('muzik')) return 'üéµ';
            if (lower.includes('baby') || lower.includes('f√´mij')) return 'üß∏';
            if (lower.includes('discovery') || lower.includes('explorer')) return 'üî¨';
            return 'üì∫';
        }

        function getCategoryName(category) {
            const names = {
                'documentarios': 'Dokumentar√´',
                'esportes': 'Sport',
                'filmesseries': 'Filma & Seri',
                'infantil': 'F√´mij√´',
                'jornalismo': 'Lajme',
                'musicas': 'Muzik√´',
                't√´-gjitha': 'T√´ Gjitha'
            };
            return names[category] || category;
        }

        // 7. SETUP EVENT LISTENERS
        function setupEventListeners() {
            // Filtro sipas kategorive
            $('.category-btn').click(function() {
                $('.category-btn').removeClass('active');
                $(this).addClass('active');
                
                const category = $(this).data('category');
                const channels = $('.channel-card');
                
                if (category === 'all') {
                    channels.fadeIn();
                } else {
                    channels.each(function() {
                        const cat = $(this).data('category');
                        $(this).toggle(cat === category);
                    });
                }
            });
            
            // K√´rko kanale
            $('#searchInput').on('input', function() {
                const query = $(this).val().toLowerCase();
                $('.channel-card').each(function() {
                    const title = $(this).find('.channel-title').text().toLowerCase();
                    $(this).toggle(title.includes(query));
                });
            });
            
            $('#searchBtn').click(function() {
                $('#searchInput').focus();
            });
            
            // Mbyll modal
            $('#closeModal').click(function() {
                $('#videoModal').fadeOut();
                if (currentHls) {
                    currentHls.destroy();
                    currentHls = null;
                }
                const video = document.getElementById('video-player');
                video.pause();
                video.src = '';
            });
            
            // Mbyll modal me ESC
            $(document).keydown(function(e) {
                if (e.key === 'Escape' && $('#videoModal').is(':visible')) {
                    $('#closeModal').click();
                }
            });
            
            // Mbyll modal duke klikuar jasht√´
            $('#videoModal').click(function(e) {
                if (e.target === this) {
                    $('#closeModal').click();
                }
            });
        }

        // 8. STARTIMI I APLIKACIONIT
        $(document).ready(function() {
            console.log('üöÄ PlayTV po starton...');
            loadPlaylist();
        });
    </script>
</body>
</html>
